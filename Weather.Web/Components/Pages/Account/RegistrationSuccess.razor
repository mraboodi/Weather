@page "/registrationSuccess"
@using Weather.Models.Entities.Identity
@using Weather.Web.Helpers
@using Weather.Web.Interfaces.Identity
@inherits LayoutComponentBase
@inject NavigationManager Nav
@inject IAuthStateService AuthStateService
@rendermode InteractiveServer

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <!-- Success Card -->
            <div class="text-center p-5 border rounded-3 shadow-sm bg-light">
                <!-- Success Icon -->
                <div class="mb-4">
                    <div class="rounded-circle bg-success d-inline-flex p-4">
                        <i class="fas fa-check text-white text-4xl animate-bounce"></i>
                    </div>
                </div>

                <!-- Message -->
                <h2 class="text-success mb-3">Account Created!</h2>
                <p class="text-muted mb-4">
                    Your registration was successful.
                    @if (AuthStateService.UserHasAnyRole(UserRoles.SuperUser, UserRoles.Administrator))
                    {
                        <text>You can continue creating users.</text>
                    }
                    else
                    {
                        <text>You can now log in to your account.</text>
                    }
                </p>

                <!-- Quick Actions -->
                <div class="d-grid gap-2 col-md-8 mx-auto">
                    @if (AuthStateService.UserHasAnyRole(UserRoles.SuperUser, UserRoles.Administrator))
                    {
                        <a href="/register" class="btn btn-success btn-lg">
                            <i class="bi bi-person-plus me-2"></i>
                            Create Another User
                        </a>
                    }
                    else
                    {
                        <a href="/login" class="btn btn-success btn-lg">
                            <i class="bi bi-box-arrow-in-right me-2"></i>
                            Sign In Now
                        </a>
                    }

                    <a href="/" class="btn btn-outline-secondary">
                        Back to Home
                    </a>
                </div>

                <!-- Extra Info -->
                <div class="mt-4 small text-muted">
                    <p class="mb-0">
                        <i class="bi bi-info-circle me-1"></i>
                        Need help? <a href="mailto:support@fcl.com?subject=Support%20Request" class="text-decoration-none">Contact Support</a>
                    </p>
                </div>
            </div>

            <!-- Auto-redirect notice (only for normal users) -->

            <div class="text-center mt-4">
                <div class="spinner-border spinner-border-sm text-success me-2" role="status"></div>
                @if (!AuthStateService.UserHasAnyRole(UserRoles.SuperUser, UserRoles.Administrator))
                {
                    <span class="text-muted">
                        Redirecting to login page automatically...
                    </span>
                }
                else
                {
                    <span class="text-muted">
                        Redirecting to register new user page
                    </span>
                }
            </div>
        </div>
    </div>
</div>

@code {

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;

        await Task.Delay(5000);
        if (AuthStateService.UserHasAnyRole(UserRoles.SuperUser, UserRoles.Administrator))
            Nav.NavigateTo("/register");
        else
            Nav.NavigateTo("/login");
    }
}
